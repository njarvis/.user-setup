#!/usr/bin/env bash

if [ -z "$LANG" ]; then
   export LANG=en_IE.UTF-8
fi

[ -d $HOME/bin/$(uname -m) ] && PATH=$HOME/bin/$(uname -m):$PATH
[ -d $HOME/.local/bin ] && PATH=$HOME/.local/bin:$PATH

# Record SSH host
if [[ ! -z "$SSH_CLIENT" ]]; then
    SSH_HOST=$(echo $SSH_CLIENT | awk '{print $1}')
    mkdir -p $HOME/.config/a4-clients
    echo SSH_HOST=${SSH_HOST} > $HOME/.config/a4-clients/ssh_host.$(hostname -s)
fi

if [ -z "$1" ]; then
    SESSION="Session"
    TARGET_SESSION=""
    NEW_SESSION=""
else
    SESSION="Session $1"
    TARGET_SESSION="-t $1"
    NEW_SESSION="-s $1"
fi

TMUX=tmux
if [ ! -z "$2" -a -x "$2" ]; then
    TMUX=$2
fi

$TMUX has-session $TARGET_SESSION 2>/dev/null
if [ "$?" -eq 1 ] ; then
    echo "$SESSION not found.  Creating and configuring."
    $TMUX new-session -d $NEW_SESSION
else
    echo "$SESSION found.  Connecting."
fi

$TMUX attach-session $TARGET_SESSION

